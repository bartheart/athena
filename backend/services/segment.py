import os
import json
import google.generativeai as genai
from dotenv import load_dotenv

load_dotenv()

# Configure the API key
genai.configure(api_key=os.environ["GOOGLE_API_KEY"])

generation_config = {
  "temperature": 1,
  "top_p": 0.95,
  "top_k": 64,
  "max_output_tokens": 8192,
  "response_mime_type": "text/plain",
}

model = genai.GenerativeModel(
  model_name="gemini-1.5-flash",
  generation_config=generation_config,
  # safety_settings = Adjust safety settings
  # See https://ai.google.dev/gemini-api/docs/safety-settings
)

def generate_prompt_with_questions(processed_questions):
    initial_prompt = [
    "input: For the following questions, extract each question and generate a list of requirements to be met in the answers in json format. For each question, divide it into meaningful segments and create a sublist of requirements or sub-requirements for each segment.  [{\"question_id\": 1, \"question\": \"What is a network protocol? List at least five network protocols (expand the abbreviations). What do these listed protocols do?\"},{\"question_id\": 2, \"question\": \"What is the internet? What is the physical view of the internet? What is the service view of the internet? \"},{\"question_id\": 3, \"question\": \"Describe network edge, access network, and network core.\"},{\"question_id\": 4, \"question\": \"Describe physical media that is used in networking. List at least three categories of physical media and explain each category.\"},{\"question_id\": 5, \"question\": \"Give at least three examples for each category of physical media. What are the unique characteristics (at least two) of the listed examples of physical media?\"},{\"question_id\": 6, \"question\": \"Describe bandwidth and data rate.\"}]",
    "output: {\n  \"questions\": [\n    {\n      \"question_id\": 1,\n      \"question\": \"What is a network protocol? List at least five network protocols (expand the abbreviations). What do these listed protocols do?\",\n      \"requirements\": [\n        {\n          \"segment\": \"What is a network protocol?\",\n          \"sub_requirements\": []\n        },\n        {\n          \"segment\": \"List at least five network protocols.\",\n          \"sub_requirements\": [\n            {\n              \"protocol\": \"Network protocol 1\",\n              \"details\": [\n                \"Expand abbreviation\",\n                \"Purpose of the protocol\"\n              ]\n            },\n            {\n              \"protocol\": \"Network protocol 2\",\n              \"details\": [\n                \"Expand abbreviation\",\n                \"Purpose of the protocol\"\n              ]\n            },\n            {\n              \"protocol\": \"Network protocol 3\",\n              \"details\": [\n                \"Expand abbreviation\",\n                \"Purpose of the protocol\"\n              ]\n            },\n            {\n              \"protocol\": \"Network protocol 4\",\n              \"details\": [\n                \"Expand abbreviation\",\n                \"Purpose of the protocol\"\n              ]\n            },\n            {\n              \"protocol\": \"Network protocol 5\",\n              \"details\": [\n                \"Expand abbreviation\",\n                \"Purpose of the protocol\"\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    {\n      \"question_id\": 2,\n      \"question\": \"What is the internet? What is the physical view of the internet? What is the service view of the internet?\",\n      \"requirements\": [\n        {\n          \"segment\": \"What is the internet?\",\n          \"sub_requirements\": []\n        },\n        {\n          \"segment\": \"What is the physical view of the internet?\",\n          \"sub_requirements\": []\n        },\n        {\n          \"segment\": \"What is the service view of the internet?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 3,\n      \"question\": \"Describe network edge, access network, and network core.\",\n      \"requirements\": [\n        {\n          \"segment\": \"Describe network edge.\",\n          \"sub_requirements\": []\n        },\n        {\n          \"segment\": \"Describe access network.\",\n          \"sub_requirements\": []\n        },\n        {\n          \"segment\": \"Describe network core.\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 4,\n      \"question\": \"Describe physical media that is used in networking. List at least three categories of physical media and explain each category.\",\n      \"requirements\": [\n        {\n          \"segment\": \"Describe physical media that is used in networking.\",\n          \"sub_requirements\": []\n        },\n        {\n          \"segment\": \"List at least three categories of physical media.\",\n          \"sub_requirements\": [\n            {\n              \"category\": \"Physical media category 1\",\n              \"details\": [\n                \"Explain the category.\"\n              ]\n            },\n            {\n              \"category\": \"Physical media category 2\",\n              \"details\": [\n                \"Explain the category.\"\n              ]\n            },\n            {\n              \"category\": \"Physical media category 3\",\n              \"details\": [\n                \"Explain the category.\"\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    {\n      \"question_id\": 5,\n      \"question\": \"Give at least three examples for each category of physical media. What are the unique characteristics (at least two) of the listed examples of physical media?\",\n      \"requirements\": [\n        {\n          \"segment\": \"Give at least three examples for each category of physical media.\",\n          \"sub_requirements\": [\n            {\n              \"category\": \"Physical media category 1\",\n              \"examples\": [\n                {\n                  \"example\": \"Example 1.1\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                },\n                {\n                  \"example\": \"Example 1.2\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                },\n                {\n                  \"example\": \"Example 1.3\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                }\n              ]\n            },\n            {\n              \"category\": \"Physical media category 2\",\n              \"examples\": [\n                {\n                  \"example\": \"Example 2.1\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                },\n                {\n                  \"example\": \"Example 2.2\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                },\n                {\n                  \"example\": \"Example 2.3\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                }\n              ]\n            },\n            {\n              \"category\": \"Physical media category 3\",\n              \"examples\": [\n                {\n                  \"example\": \"Example 3.1\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                },\n                {\n                  \"example\": \"Example 3.2\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                },\n                {\n                  \"example\": \"Example 3.3\",\n                  \"details\": [\n                    \"Unique characteristic 1\",\n                    \"Unique characteristic 2\"\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    {\n      \"question_id\": 6,\n      \"question\": \"Describe bandwidth and data rate.\",\n      \"requirements\": [\n        {\n          \"segment\": \"Describe bandwidth.\",\n          \"sub_requirements\": []\n        },\n        {\n          \"segment\": \"Describe data rate.\",\n          \"sub_requirements\": []\n        }\n      ]\n    }\n  ]\n}",
    "input: For the following questions, extract each question and generate a list of requirements to be met in the answers in json format. For each question, divide it into meaningful segments and create a sublist of requirements or sub-requirements for each segment.  [{'question_id': 1, 'question': 'what is the role of a prototype program in problem solving?'}, {'question_id': 2, 'question': 'what stages in the software life cycle are influenced by the testing\\nstage?'}, {'question_id': 3, 'question': 'what are the main advantages associated with object-oriented\\nprogramming?'}, {'question_id': 4, 'question': 'where do c++ programs begin to execute?'}, {'question_id': 5, 'question': 'what is a variable?'}, {'question_id': 6, 'question': 'where are variables declared in a c++ program?'}, {'question_id': 7, 'question': 'what is the main difference between a while and a do...while\\nstatement?'}, {'question_id': 8, 'question': 'what is typically included in a class definition?'}, {'question_id': 9, 'question': 'what is typically included in a class definition?'}, {'question_id': 10, 'question': 'what is the difference between a data member and a local\\nvariable inside a member function?'}, {'question_id': 11, 'question': 'what is the difference between a constructor and a function?'}, {'question_id': 12, 'question': 'when does c++ create a default constructor?'}, {'question_id': 13, 'question': 'how many constructors can be created for a class?'}, {'question_id': 14, 'question': 'what is the difference between a function prototype and a\\nfunction definition?'}, {'question_id': 15, 'question': 'what is the role of a header-file?'}, {'question_id': 16, 'question': 'what does a function signature include?'}, {'question_id': 17, 'question': 'what is the scope of global variables?'}",
    "output: {\n  \"questions\": [\n    {\n      \"question_id\": 1,\n      \"question\": \"what is the role of a prototype program in problem solving?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is the role of a prototype program in problem solving?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 2,\n      \"question\": \"what stages in the software life cycle are influenced by the testing\\nstage?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what stages in the software life cycle are influenced by the testing\\nstage?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 3,\n      \"question\": \"what are the main advantages associated with object-oriented\\nprogramming?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what are the main advantages associated with object-oriented\\nprogramming?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 4,\n      \"question\": \"where do c++ programs begin to execute?\",\n      \"requirements\": [\n        {\n          \"segment\": \"where do c++ programs begin to execute?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 5,\n      \"question\": \"what is a variable?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is a variable?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 6,\n      \"question\": \"where are variables declared in a c++ program?\",\n      \"requirements\": [\n        {\n          \"segment\": \"where are variables declared in a c++ program?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 7,\n      \"question\": \"what is the main difference between a while and a do...while\\nstatement?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is the main difference between a while and a do...while\\nstatement?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 8,\n      \"question\": \"what is typically included in a class definition?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is typically included in a class definition?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 9,\n      \"question\": \"what is typically included in a class definition?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is typically included in a class definition?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 10,\n      \"question\": \"what is the difference between a data member and a local\\nvariable inside a member function?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is the difference between a data member and a local\\nvariable inside a member function?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 11,\n      \"question\": \"what is the difference between a constructor and a function?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is the difference between a constructor and a function?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 12,\n      \"question\": \"when does c++ create a default constructor?\",\n      \"requirements\": [\n        {\n          \"segment\": \"when does c++ create a default constructor?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 13,\n      \"question\": \"how many constructors can be created for a class?\",\n      \"requirements\": [\n        {\n          \"segment\": \"how many constructors can be created for a class?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 14,\n      \"question\": \"what is the difference between a function prototype and a\\nfunction definition?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is the difference between a function prototype and a\\nfunction definition?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 15,\n      \"question\": \"what is the role of a header-file?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is the role of a header-file?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 16,\n      \"question\": \"what does a function signature include?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what does a function signature include?\",\n          \"sub_requirements\": []\n        }\n      ]\n    },\n    {\n      \"question_id\": 17,\n      \"question\": \"what is the scope of global variables?\",\n      \"requirements\": [\n        {\n          \"segment\": \"what is the scope of global variables?\",\n          \"sub_requirements\": []\n        }\n      ]\n    }\n  ]\n}",
    "input: For the following questions, extract each question and generate a list of requirements to be met in the answers in json format. For each question, divide it into meaningful segments and create a sublist of requirements or sub-requirements for each segment."
    ]

    # Convert the processed questions to JSON format
    processed_questions_json = json.dumps(processed_questions)

    # Define the final output string
    final_output = "output: "

    # Concatenate the strings to form the final prompt
    final_prompt = f"{initial_prompt}\ninput: {processed_questions_json}\n{final_output}"

    response = model.generate_content([final_prompt])

    return response.text

processed_questions = [
    {"question_id": 1, "question": "what is the role of a prototype program in problem solving?"},
    {"question_id": 2, "question": "what stages in the software life cycle are influenced by the testing\nstage?"},
    {"question_id": 3, "question": "what are the main advantages associated with object-oriented\nprogramming?"},
    {"question_id": 4, "question": "where do c++ programs begin to execute?"},
    {"question_id": 5, "question": "what is a variable?"},
    {"question_id": 6, "question": "where are variables declared in a c++ program?"}
]

response_text = generate_prompt_with_questions(processed_questions)
print(response_text)